(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,n,t){"use strict";t.r(n);var r={};t.r(r),t.d(r,"nil",function(){return l}),t.d(r,"cons",function(){return p}),t.d(r,"pop",function(){return d}),t.d(r,"equals",function(){return v}),t.d(r,"getLast",function(){return m}),t.d(r,"toArray",function(){return g}),t.d(r,"toString",function(){return h});var u=t(1),o=t.n(u),i=t(30),c=t.n(i);t(81),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var a=t(53),s=t(11),f=t(2),l={type:"nil",length:0},p=function(e,n){return{type:"cons",value:e,prev:n,length:n.length+1}},d=function(e){return"nil"===e.type?e:e.prev};function v(e,n){for(var t=e,r=n;;)switch(t.type){case"nil":return"nil"===r.type;case"cons":if("cons"!==r.type||t.value!==r.value)return!1;t=t.prev,r=r.prev;break;default:throw Error("WTF!")}}var m=function(e){return"nil"===e.type?f.none:f.some(e.value)},g=function(e){for(var n=e.length,t=new Array(n),r=e,u=1;"nil"!==r.type;)t[n-u]=r.value,u++,r=r.prev;return t},h=function(e){return g(e).map(function(e){return""+e}).join("/")},b=t(3),y={currentId:l,label:f.none,enabled:!0},I={activeId:f.none,activeIdIsAlive:f.none,activeIdWasPressedBefore:!1,pressedId:f.none,focusedId:f.none,inputBuffer:f.none,autoFocus:!0},O=function(e){return e.enabled};function j(e){return f.isSome(e.activeId)&&f.isSome(e.activeIdIsAlive)&&!S.equals(e.activeId,e.activeIdIsAlive)}function w(e){return function(n){return Object(s.a)({},n,{activeId:e,activeIdIsAlive:e,activeIdWasPressedBefore:!!S.equals(e,n.activeId)&&n.activeIdWasPressedBefore,inputBuffer:S.equals(e,n.activeId)?n.inputBuffer:f.none})}}function E(e){return function(n){return Object(s.a)({},n,{activeIdIsAlive:e})}}function k(e){return function(n){return Object(s.a)({},n,{pressedId:e})}}function A(e){return function(n){return Object(s.a)({},n,{focusedId:e})}}function T(e){return function(n){return Object(s.a)({},n,{inputBuffer:e})}}var S=f.getEq(r);function D(e,n){return S.equals(f.some(e),n.activeId)}function B(e,n){return D(e.currentId,n)}function x(e,n){return S.equals(f.some(e.currentId),n.focusedId)}function L(e,n){return f.isNone(n.activeId)&&!B(e,n)}var q=function(e,n){return{type:"text",id:e,text:n}},W=function(e,n,t){return{type:"input",id:e,value:n,enabled:t}},C=t(13),F=t(49),N=t(48),M=function(e){return{type:"continue",state:e}},P=function(e){return{type:"suspendAndResume",effect:e}},$=function(e,n,t){return function(r){switch(r.type){case"continue":return e(r.state);case"suspendAndResume":return n(r.effect);case"halt":return t();default:throw Error("WTF!")}}},R={equals:function(e,n){return v(e.ui.id,n.ui.id)},compare:function(e,n){return 0}},J=function(e){return function(e){return{type:"halt"}}},U=function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return{type:"translable_string",strings:e,values:t}},z=function(e){return C.asks(function(n){return{ui:q(n.currentId,e),tick:J}})},_=function(e){return function(n){return function(n){return function(n){return(t=e.map(function(e){return e.tick(e.ui)}),function(e){for(var n=e,r=0;t.length>r;){var u=t[r](n);switch(u.type){case"halt":break;case"continue":n=u.state;break;case"suspendAndResume":return u;default:throw Error("WTF!")}r++}return n!==e?M(n):{type:"halt"}})(n);var t}}}},G=function(e){return Object(b.pipe)(F.array.sequence(C.reader)(e),C.map(F.sort(R)),C.chain(function(e){return C.asks(function(n){return{ui:(t=n.currentId,r=e.map(function(e){return e.ui}),{type:"container",id:t,children:r}),tick:_(e)(n)};var t,r})}))},H=function(e,n,t,r){return function(u){return function(o){return function(o){var i=L(u,o),c=B(u,o),a=x(u,o),s=function(e,n){return B(e,n)}(u,o),l=O(u);if(c&&f.isNone(o.activeIdIsAlive))return M(E(f.some(u.currentId))(o));if(c&&!l)return M(Object(b.pipe)(o,w(f.some(u.currentId))));if(l){if(!c&&a&&i)return M(Object(b.pipe)(o,w(f.some(u.currentId))));if(c&&!a&&s){if(f.isNone(o.inputBuffer)&&t)return M(Object(b.pipe)(o,w(f.none)));var p=f.getOrElse(function(){return e})(o.inputBuffer);if(r(p))return console.log("input: run onChange"),P(Object(b.pipe)(n(p),N.map(function(){return T(f.none)(o)})))}}return{type:"halt"}}}}},K=function(e,n,t,r){return C.asks(function(u){return{ui:W(u.currentId,e,O(u)),tick:H(e,n,t,r)(u)}})},Q=function(e){return!0},V=function(e,n,t){return K(e,n,t,Q)},X=function(e){return function(n){return Object(b.pipe)(n,C.local((t=e,function(e){return Object(s.a)({},e,{currentId:p(t,e.currentId)})})));var t}},Y=t(54),Z=t(55),ee=t(74),ne=t(56),te=t(75),re=t(73),ue=t(107),oe=t(111),ie=t(71),ce=t(108),ae=t(109),se=t(110),fe=u.createContext(ae.a(I));function le(e){switch(e.dsl.type){case"input":return u.createElement(ve,Object.assign({},e,{key:h(e.dsl.id)}));case"container":return u.createElement(he,Object.assign({},e,{key:h(e.dsl.id)}));case"text":return u.createElement(me,Object.assign({},e,{key:h(e.dsl.id)}));case"button":return u.createElement(ge,Object.assign({},e,{key:h(e.dsl.id)}))}return u.createElement(u.Fragment,null,JSON.stringify(e.dsl))}function pe(e){return e.strings.map(function(n,t){return n+(e.values[t]||"")}).join("")}function de(e,n){var t=u.useState(n),r=Object(re.a)(t,2),o=r[0],i=r[1];return u.useLayoutEffect(function(){var n=e.subscribe(i);return function(){return n.unsubscribe()}},[e]),o}var ve=u.memo(function(e){var n=u.useContext(fe),t=e.dispatch,r=e.update,o=e.dsl.id,i=e.dsl.value||"",c=h(o),a=u.useMemo(function(){return function(e){return r(T(f.some(e)))()}},[r]),s=u.useMemo(function(){return t(A(f.some(o)))},[t,c]),l=u.useMemo(function(){return t(A(f.none))},[t,c]),p=u.useRef(),d=u.useMemo(function(){return n.pipe(ue.a(function(e){return D(o,e)}))},[n,c]),v=u.useMemo(function(){return n.pipe(ue.a(function(e){return function(e,n){return S.equals(f.some(e),n.focusedId)}(o,e)}))},[n,c]),m=u.useMemo(function(){return n.pipe(ue.a(function(e){return D(o,e)?f.getOrElse(function(){return i})(e.inputBuffer):i}))},[n,c,i]),g=de(d,!1),b=de(v,!1),y=de(m,i);return u.useLayoutEffect(function(){b&&p.current&&!p.current.isFocused()&&(p.current.focus(),console.log("forced focus to",c))}),"input"!==e.dsl.type?null:u.createElement(oe.a,{ref:p,editable:g,value:y,onChangeText:g?a:void 0,onFocus:b?void 0:s,onBlur:b?l:void 0,autoCapitalize:"none"})});ve.displayName="DSL(Input)";var me=u.memo(function(e){return"text"!==e.dsl.type?null:u.createElement(ie.a,null,pe(e.dsl.text))});me.displayName="DSL(Text)";var ge=u.memo(function(e){return"button"!==e.dsl.type?null:u.createElement(ce.a,{onPress:function(){e.dispatch(k(f.some(e.dsl.id)))(),e.dispatch(k(f.none))()},title:pe(e.dsl.text)})});ge.displayName="DSL(Button)";var he=u.memo(function(e){return"container"!==e.dsl.type?null:u.createElement(u.Fragment,{key:h(e.dsl.id)},e.dsl.children.map(function(n,t){return le(Object(s.a)({},e,{dsl:n}))}))});he.displayName="DSL(Container)";var be=u.memo(function(e){return le(e)}),ye=function(e){function n(e){var t;return Object(Y.a)(this,n),(t=Object(ee.a)(this,Object(ne.a)(n).call(this,e))).state=I,t.state$=new se.a(t.state),t.app=void 0,t.eventLoop=function(e){for(var n,r=(new Date).getTime(),u=(n=e,Object(b.pipe)(n,E(f.none))),o=!0,i=0,c=[];o;){var a=t.app.tick(t.app.ui)(u);if(u=Object(b.pipe)(a,$(function(e){return e},function(e){var n=e();return t.app=t.getApp(t.props),n},function(){return o=!1,u})),o&&i>=20)throw c.push(u),new Error("Error while converging! Last application states are reported in console.");i++,o||j(u)&&(u=w(f.none)(u),c.push(u),o=!0)}var s=(new Date).getTime()-r;return console.log("event loop took "+s+"ms"),console.log(i+" frames processed"),u},t.dispatch=function(e){return function(){return t.setState(function(n){var r=t.eventLoop(e(n));return t.state$.next(r),r})}},t.update=function(e){return function(){return t.setState(function(n){var r=e(n);return t.state$.next(r),r})}},t.app=t.getApp(e),t}return Object(te.a)(n,e),Object(Z.a)(n,[{key:"getApp",value:function(e){var n=(new Date).getTime(),t=e.getApp(),r=(new Date).getTime()-n;console.log("generating DSL took "+r+"ms");var u=(new Date).getTime(),o=t(y),i=(new Date).getTime()-u;return console.log("building DSL took "+i+"ms"),o}},{key:"componentWillMount",value:function(){var e=this;this.setState(function(n){return e.eventLoop(n)})}},{key:"render",value:function(){return u.createElement(fe.Provider,{value:this.state$},u.createElement(be,{dsl:this.app.ui,dispatch:this.dispatch,update:this.update}))}}]),n}(u.Component);function Ie(){var e=Object(a.a)(["Counter ",":"]);return Ie=function(){return e},e}for(var Oe=[],je=0;je<300;je++)Oe.push(""+je);var we=Oe;c.a.render(o.a.createElement(function(){return u.createElement(ye,{getApp:function(){return(e=we,function(n){return G(Oe.map(function(t,r){return Object(b.pipe)(G([Object(b.pipe)(z(U(Ie(),""+r)),X("label"+r)),Object(b.pipe)(V(e[r],function(t){return n(e.slice(0,r).concat([t]).concat(e.slice(r+1)))},!0),X("name"+r))]),X("div"+r))}))})(function(e){return console.log("STATE UPDATE",e),function(){console.log("STATE UPDATED",e),we=e}});var e}})},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},76:function(e,n,t){e.exports=t(100)},81:function(e,n,t){}},[[76,1,2]]]);
//# sourceMappingURL=main.31c30a26.chunk.js.map